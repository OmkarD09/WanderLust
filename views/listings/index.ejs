<% layout('/layouts/boilerplate') %>

<style>
    
    #filters {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        gap: 0.5rem;
        margin-top: 1rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        position: relative;
    }

    .tax-switch-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-left: auto;
        white-space: nowrap;
    }

    .tax-switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 22px;
    }

    .tax-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .tax-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 24px;
    }

    .tax-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .tax-slider {
        background-color: #2196F3;
    }

    input:checked + .tax-slider:before {
        transform: translateX(22px);
    }

    .tax-label {
        font-size: 0.8rem;
        font-weight: 500;
        color: #333;
    }

    .filter {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        transition: transform 0.2s;
        flex: 1;
        min-width: 0;
        margin-bottom: 1rem;
        text-decoration: none;
        color: inherit;
    }

    .filter:hover {
        transform: scale(1.05);
    }

    .filter div {
        background-color: #f0f0f0;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 0.3rem;
        font-size: 0.9rem;
    }

    .filter p {
        margin: 0;
        font-size: 0.75rem;
        font-weight: bold;
        text-align: center;
        width: 100%;
        word-wrap: break-word;
    }
</style>

<body>
    <% if (typeof categoryTitle !== 'undefined' && categoryTitle) { %>
        <div class="d-flex justify-content-between align-items-center mt-3 mb-3">
            <h3><%= categoryTitle %> Listings</h3>
            <a href="/listings" class="btn btn-secondary">View All Listings</a>
        </div>
    <% } %>
    <div id="filters">
        <a href="/listings/category/trending" class="filter">
            <div><i class="fa-solid fa-fire"></i></div>
            <p>Trending</p>
        </a>
        <a href="/listings/category/near-me" class="filter">
            <div><i class="fa-solid fa-location-dot"></i></div>
            <p>Near Me</p> 
        </a>
        <a href="/listings/category/budget" class="filter">
            <div><i class="fa-solid fa-tags"></i></div>
            <p>Budget</p>
        </a>
        <a href="/listings/category/Mountains" class="filter">
            <div><i class="fa-solid fa-mountain"></i></div>
            <p>Mountains</p>
        </a>
        <a href="/listings/category/Beaches" class="filter">
            <div><i class="fa-solid fa-umbrella-beach"></i></div>
            <p>Beaches</p>
        </a>
        <a href="/listings/category/Iconic Cities" class="filter">
            <div><i class="fa-solid fa-city"></i></div>
            <p>Iconic Cities</p>
        </a>
        <a href="/listings/category/Nature" class="filter">
            <div><i class="fa-solid fa-tree"></i></div>
            <p>Nature</p>
        </a>
        <a href="/listings/category/Amazing Pools" class="filter">
            <div><i class="fa-solid fa-person-swimming"></i></div>
            <p>Amazing Pools</p>
        </a>
        <a href="/listings/category/Camping" class="filter">
            <div><i class="fa-solid fa-campground"></i></div>
            <p>Camping</p>
        </a>
        <a href="/listings/category/Castles" class="filter">
            <div><i class="fa-brands fa-fort-awesome"></i></div>
            <p>Castles</p>
        </a>
        <a href="/listings/category/Skiing" class="filter">
            <div><i class="fa-solid fa-skiing"></i></div>
            <p>Skiing</p>
        </a>
        <a href="/listings/category/Farms" class="filter">
            <div><i class="fa-solid fa-cow"></i></div>
            <p>Farms</p>
        </a>
        
        <div class="tax-switch-container">
            <span class="tax-label">Include 18% GST</span>
            <label class="tax-switch">
                <input type="checkbox" id="gstToggle">
                <span class="tax-slider"></span>
            </label>
        </div>
    </div>
    <!-- <h3>All Listings</h3> -->
    <!-- <form action="/listings/new" method="GET">
        <button type="submit">Create New Listing</button>
    </form method> -->
    <% if (listings && listings.length > 0) { %>
        <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-3">
            <% for(let listing of listings) { %>
                <a href="/listings/<%= listing._id %>">
                    <div class="card col listing-card">
                        <img src="<%= listing.image.url %>" class="card-img-top" alt="listing_image" style="height: 20rem;">
                        <div class="card-img-overlay"></div>
                        <div class="card-body">
                            <p class="card-text">
                                <b><%= listing.title %></b> <br>
                                <span class="price-display" data-base-price="<%= listing.price || 0 %>">
                                    &#8377;<%= listing.price ? listing.price.toLocaleString("en-IN") : 'N/A' %>
                                </span>
                                <span class="gst-text" style="display: none; font-size: 0.85em; color: #666;"> (incl. GST)</span>
                            </p>
                        </div>
                    </div>
                </a>
            <% } %>
        </div>
    <% } else { %>
        <div class="alert alert-info mt-4" role="alert">
            <h5>No listings found</h5>
            <p>There are no listings available in this category at the moment.</p>
            <a href="/listings" class="btn btn-primary">View All Listings</a>
        </div>
    <% } %>


    <!-- <% for(let listing of listings) { %>
       <ul>
           <li><a href="/listings/<%= listing._id %>"><%= listing.title %></a></li>
       </ul>
    <% } %> -->

    <%- include('../includes/footer.ejs') %>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const gstToggle = document.getElementById('gstToggle');
            const priceDisplays = document.querySelectorAll('.price-display');
            const gstTexts = document.querySelectorAll('.gst-text');
            const GST_RATE = 0.18; // 18% GST

            function updatePrices() {
                priceDisplays.forEach((priceDisplay, index) => {
                    const basePrice = parseFloat(priceDisplay.getAttribute('data-base-price'));
                    if (isNaN(basePrice) || basePrice === 0) {
                        return;
                    }

                    if (gstToggle.checked) {
                        // Show price with GST
                        const priceWithGST = basePrice * (1 + GST_RATE);
                        priceDisplay.innerHTML = '&#8377;' + Math.round(priceWithGST).toLocaleString("en-IN");
                        gstTexts[index].style.display = 'inline';
                    } else {
                        // Show base price without GST
                        priceDisplay.innerHTML = '&#8377;' + basePrice.toLocaleString("en-IN");
                        gstTexts[index].style.display = 'none';
                    }
                });
            }

            gstToggle.addEventListener('change', updatePrices);
        });
    </script>

</body>
